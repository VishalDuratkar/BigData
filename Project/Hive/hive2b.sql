INSERT OVERWRITE DIRECTORY '/project/project2b' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' STORED AS TEXTFILE select year,state, Count from(select s.year, s.state, s.Count, rank() over (partition by year order by Count desc) as rank from(select t.year, t.state, sum(t.total) as Count from(select year, trim(split(worksite,",")[1]) as state, count(*) as total from partitionByYear where case_status='CERTIFIED'group by year,worksite order by year, total desc) t group by year,state order by year, Count desc) s)ranking where rank <=5;
